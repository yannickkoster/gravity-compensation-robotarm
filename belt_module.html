<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slider test</title>
    <script src="./d3.min.js"></script>
    <script type="application/javascript" src="./UI_2.js"></script>
  </head>
  <body>
    <script>




      /*
      GLOBAL VARS
       */

      const WIDTH = 300;

      const LENGTH_MAX = 200; // yk max length of linkage 1
      const LENGTH_START = 100; // yk min length of linkage 1

      var data = d3.range(0, LENGTH_MAX + 1, 1);
      var units = '[cm]';
      var units_mass = '[g]';

      const FPS = 30;

      const LINKAGE_HEIGHT = 10;
      const MOTOR_RADIUS = 20;
      const MAX_TORQUE = 20; // max torque for 2 QDD for 30 seconds
      const PULLEY_RADIUS = 30;
      const PAYLOAD_SIZE = 50;
      const PAYLOAD_MASS = 500; // in g
      const PAYLOAD_MASS_MAX = 1000; // in kg

      var data_mass = d3.range(0, PAYLOAD_MASS_MAX + 1, 1);

      /* SLIDER */

      slider_T = new Slider("Length", data, WIDTH, LENGTH_START, "d", units);
      slider_mass = new Slider("Mass", data_mass, WIDTH, PAYLOAD_MASS, "d", units_mass);

      /*SVG*/

      var svg = d3.select("body").append("svg")
        .attr("width", 1000)
        .attr("height", 500);

      /* torque calc */
      // l1 is in cm
      // kg in g
      function torque(l1, m2){
        const GRAVITY = 9.81; // in kg/mÂ²
        return l1/100 * m2/1000 * GRAVITY;
      }

      /*functions to create objects*/

      function add_circle(cx,cy,r,m,color,o){
        return svg.append("circle")
                .attr("cx", cx)
                .attr("cy", cy)
                .attr("r", r)
                .attr("stroke", color)
                .attr("stroke-width", 5)
                .attr("fill", "none")
                .attr("stroke-opacity", o)
                ;
      }

      function add_line(x1,y1,x2,y2,s, o){
        return svg.append("line")
                .attr("x1", x1)
                .attr("y1", y1)
                .attr("x2", x2)
                .attr("y2", y2)
                .attr("stroke", s)
                .attr("stroke-width", 5)
                .attr("stroke-opacity", o)
                ;
      }

      function add_rect(x,y,l, h,color){
        return svg.append("rect")
                .attr("width", l)
                .attr("height", h)
                .attr("x", x)
                .attr("y", y)
                .attr("stroke", color)
                .attr("stroke-width", 5)
                ;
      }

      function add_text(x,y,t){
        return svg.append("text")
                .attr("dominant-baseline", "middle")
                .append("tspan")
                .attr("x", x)
                .attr("y", y)
                .attr("style", "font-family: Helvetica, Arial, sans-serif;")
                .text(t)
        ;
      }

      var torque_load = add_text(600,350,"load torque = " + torque(LENGTH_START, PAYLOAD_MASS) + " Nm");
      var torque_ut = add_text(600,400,"utilization of torque 1 = " + 100*torque(LENGTH_START, PAYLOAD_MASS)/MAX_TORQUE + "%");

      /*creating objects*/

      var motor1 = add_circle(100, 400 + LINKAGE_HEIGHT/2, MOTOR_RADIUS, 1, "black", 1);
      var motor2 = add_circle(100, 400 + LINKAGE_HEIGHT/2 - 10, MOTOR_RADIUS, 1, "black", 0.3);

      var pulley1 = add_circle(250, 400 + LINKAGE_HEIGHT/2, PULLEY_RADIUS, 1, "blue", 1);
      var pulley2 = add_circle(250, 400 + LINKAGE_HEIGHT/2 - 10, PULLEY_RADIUS, 1, "blue", 0.3);

      var belt1_lower = add_line(100,400 + LINKAGE_HEIGHT/2 + MOTOR_RADIUS, 250, 400 + LINKAGE_HEIGHT/2 + PULLEY_RADIUS, "red", 1);
      var belt1_upper = add_line(100,400 + LINKAGE_HEIGHT/2 - MOTOR_RADIUS, 250, 400 + LINKAGE_HEIGHT/2 - PULLEY_RADIUS, "red", 1);
      var belt2_lower = add_line(100, 400 + LINKAGE_HEIGHT/2 + MOTOR_RADIUS - 10, 250, 400 + LINKAGE_HEIGHT/2 + PULLEY_RADIUS - 10, "red", 0.3);
      var belt2_upper = add_line(100,400 + LINKAGE_HEIGHT/2 - MOTOR_RADIUS - 10, 250, 400 + LINKAGE_HEIGHT/2 - PULLEY_RADIUS - 10, "red", 0.3);

      var bevel = add_line(250, 400 + LINKAGE_HEIGHT/2 + PULLEY_RADIUS - 10, 250, 400 + LINKAGE_HEIGHT/2 - PULLEY_RADIUS + 10, "blue", 1);

      var linkage1 = add_rect(250,
              400 + LINKAGE_HEIGHT/2 - 2.5,
              LENGTH_START,
              5,
              "black"
      );

      var payload = add_rect(250 + LENGTH_START - PAYLOAD_SIZE/2,
              400 + LINKAGE_HEIGHT/2 - PAYLOAD_SIZE/2,
              PAYLOAD_SIZE,
              PAYLOAD_SIZE,
              "black"
      );


      /* kinematics */
      d3.interval(function(elapsed){
        console.log(slider_T.value)
        linkage1.attr("width", slider_T.value)


        payload.attr("x", slider_T.value + 250 - PAYLOAD_SIZE/2)
        torque_ut.text("utilization of torque 1 = " + 100*torque(slider_T.value, slider_mass.value)/MAX_TORQUE + "%")
        torque_load.text("load torque1 = " + torque(slider_T.value, slider_mass.value) + " Nm")


      }, (1/FPS)*1e3);




    </script>
  </body>
</html>
